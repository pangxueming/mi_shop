{"version":3,"sources":["uni-app:///main.js","webpack:///D:/Code/Vue/新项目/mi_shop/pages/order-detail/order-detail.vue?0ea3","webpack:///D:/Code/Vue/新项目/mi_shop/pages/order-detail/order-detail.vue?991d","webpack:///D:/Code/Vue/新项目/mi_shop/pages/order-detail/order-detail.vue?d88f","webpack:///D:/Code/Vue/新项目/mi_shop/pages/order-detail/order-detail.vue?abf4","uni-app:///pages/order-detail/order-detail.vue"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,iH;AACAA,UAAU,CAACC,oBAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAyH;AACzH;AACgE;AACL;;;AAG3D;AACkN;AAClN,gBAAgB,sNAAU;AAC1B,EAAE,kFAAM;AACR,EAAE,uFAAM;AACR,EAAE,gGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,2FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAo1B,CAAgB,m0BAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC+Ex2B,yF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AALA,iB,6lDAOA,EACA,cACA,4BADA,EAEA,wBAFA,EAGA,YAHA,EAIA,UAJA,EAKA,0BALA,EADA,EAQA,IARA,kBAQA,CACA,SACA,KADA,EAEA,MAFA,EAGA,WACA,YADA,EAEA,QAFA,EAGA,YAHA,EAIA,WAJA,EAKA,MALA,EAMA,QANA,EAOA,SAPA,EAHA,EAYA,cAZA,EAaA,UAbA,EAcA,eAdA,EAeA,kBAfA,EAgBA,cAhBA,EAiBA,wBAjBA,EAkBA,eAlBA,EAmBA,WAnBA,EAoBA,eApBA,EAqBA,eArBA,EAsBA,WAtBA,EAuBA,eAvBA,EAwBA,kBAxBA,EAyBA,WAzBA,EA0BA,YA1BA,GA4BA,CArCA,EAsCA,YACA;AACA,SAFA,mBAEA,CACA,UACA,0CACA,4BACA,CAFA,EAGA,oBACA,CARA,EASA,IATA,kBASA,qBACA,YADA,CACA,QADA,iBACA,QADA,CACA,IADA,iBACA,IADA,CACA,QADA,iBACA,QADA,CACA,OADA,iBACA,OADA,CAEA,wFACA,CAZA,EAaA;AACA,UAdA,oBAcA,CACA,8BACA,yBADA,EAEA,iCAFA,EAGA,6BAHA,IAKA,CApBA,EAqBA,MArBA,oBAqBA,CACA,6EACA,aACA,CAHA,4BAIA,0BAJA,CAIA,IAJA,yBAIA,IAJA,CAIA,KAJA,yBAIA,KAJA,CAKA,iBACA,oBACA,CAFA,MAEA,CACA,yBACA,CACA,CA/BA,EAgCA,YAhCA,0BAgCA,CACA,aACA,sBACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAfA;;AAiBA;AACA;AACA;AACA;AACA,KAvDA,EAtCA;;AA+FA,QA/FA,kBA+FA,CA/FA,EA+FA;AACA;AACA;AACA,sBADA;AAEA,oBAFA;;AAIA;AACA,gBADA;;AAGA;AACA;AACA,GA1GA;AA2GA,UA3GA,sBA2GA;AACA;AACA;AACA;AACA,GA/GA;AAgHA,QAhHA,oBAgHA;AACA;AACA;AACA,GAnHA;AAoHA;AACA;AACA,gBAFA,0BAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCADA;;AAGA;AACA,+DADA;AAEA,0BAFA;;AAIA;AACA;AACA;AACA;AACA,SAdA,EAcA,IAdA;AAeA;AACA,KAvBA;AAwBA,WAxBA,qBAwBA;AACA;AACA,SADA;AAEA,yBAFA;AAGA,QAHA;AAIA;AACA,mBADA,EAJA;;;AAQA,UARA,CAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BADA;AAEA,oCAFA;AAGA,oCAHA;AAIA,2BAJA;AAKA,kCALA;AAMA,sBANA;;AAQA,SAhBA;AAiBA;AACA;AACA;AACA;AACA,OA9CA;AA+CA,KAxEA;AAyEA;AACA,kBA1EA,4BA0EA;AACA;AACA;AACA;AACA;AACA;AACA,qBADA;AAEA,iCAFA,GAHA;;;AAQA,KApFA;AAqFA;AACA,cAtFA,wBAsFA;AACA;AACA,4BADA;AAEA;AACA;AACA;AACA,+BADA;AAEA,yBAFA;;AAIA;AACA,gBADA;AAEA,sCAFA;AAGA,cAHA;AAIA;AACA,yBADA,EAJA;;;AAQA,gBARA,CAQA;AACA;AACA;AACA,wBADA;;AAGA;AACA,+BADA;AAEA,4BAFA;;AAIA,aAjBA;AAkBA,iBAlBA,CAkBA;AACA;AACA,aApBA;AAqBA;AACA,SA9BA;;AAgCA,KAvHA;AAwHA;AACA,eAzHA,yBAyHA;AACA;AACA;AACA;AACA;AACA,qBADA,GAHA;;;AAOA,KAjIA;AAkIA;AACA,iBAnIA,2BAmIA;AACA;AACA;AACA;AACA;AACA,qBADA,GAHA;;;AAOA,KA3IA;AA4IA;AACA,YA7IA,sBA6IA;AACA;AACA,2BADA;AAEA;AACA;AACA;AACA,+BADA;AAEA,yBAFA;;AAIA;AACA,gBADA;AAEA,+CAFA;AAGA,cAHA;AAIA;AACA,yBADA,EAJA;;;AAQA,gBARA,CAQA;AACA;AACA;AACA,wBADA;;AAGA;AACA,+BADA;AAEA,4BAFA;;AAIA,aAjBA;AAkBA,iBAlBA,CAkBA;AACA;AACA,aApBA;AAqBA;AACA,SA9BA;;AAgCA,KA9KA,EApHA,E","file":"pages/order-detail/order-detail.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/order-detail/order-detail.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./order-detail.vue?vue&type=template&id=d80893f4&\"\nvar renderjs\nimport script from \"./order-detail.vue?vue&type=script&lang=js&\"\nexport * from \"./order-detail.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/order-detail/order-detail.vue\"\nexport default component.exports","export * from \"-!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./order-detail.vue?vue&type=template&id=d80893f4&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./order-detail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./order-detail.vue?vue&type=script&lang=js&\"","<template>\n  <view>\n    <view class=\"main-bg-color text-white p-4 d-flex a-end j-sb\" style=\"height: 300rpx;\">\n      <view class=\"mb-3\">\n        <view class=\"font-lg\">{{ status }}</view>\n        <view class=\"font\">{{ timeDownText }}</view>\n      </view>\n      <view class=\"iconfont icon-daishouhuo line-h mb-3\" style=\"font-size: 100rpx;\"></view>\n    </view>\n    <view class=\"p-3 bg-white\">\n      <view class=\"text-light-muted font-md\">\n        <text class=\"font-lg text-dark mr-2\">{{ address.name }}</text>\n        {{ address.phone }}\n      </view>\n      <view class=\"text-light-muted font-md\">{{ path }}</view>\n    </view>\n    <divider></divider>\n    <view class=\"px-2\">\n      <block v-for=\"(item, index) in order_items\" :key=\"index\"><order-list-item :item=\"item\" :index=\"index\"></order-list-item></block>\n    </view>\n    <divider></divider>\n    <uni-list-item>\n      <text class=\"font-md text-light-muted\">商品总价</text>\n      <view slot=\"right\" class=\"font-md text-light-muted\">{{ price }}</view>\n    </uni-list-item>\n    <uni-list-item>\n      <text class=\"font-md text-light-muted\">快递</text>\n      <view slot=\"right\" class=\"font-md text-light-muted\">包邮</view>\n    </uni-list-item>\n    <uni-list-item>\n      <text class=\"font-md text-light-muted\">优惠券</text>\n      <view slot=\"right\" class=\"font-md text-light-muted\">{{ coupon }}</view>\n    </uni-list-item>\n    <uni-list-item>\n      <text class=\"font-md main-text-color\">实际付款</text>\n      <view slot=\"right\" class=\"font-md text-light-muted\">\n        <price>{{ total_price }}</price>\n      </view>\n    </uni-list-item>\n    <divider></divider>\n    <card headTitle=\"订单信息\">\n      <uni-list-item title=\"订单编号\">\n        <view slot=\"right\" class=\"font-md text-light-muted\">{{ no }}</view>\n      </uni-list-item>\n    </card>\n    <card v-if=\"extra\" headTitle=\"退款相关\">\n      <uni-list-item title=\"申请退款\">\n        <view slot=\"right\" class=\"font-md text-light-muted\">{{ extra.refund_reason }}</view>\n      </uni-list-item>\n    </card>\n\n    <view v-if=\"status === '待支付' || status === '待发货' || status === '待收货'\" style=\"height: 100rpx;\"></view>\n    <view\n      v-if=\"status === '待支付' || status === '待发货' || status === '待收货'\"\n      class=\"bg-white position-fixed bottom-0 left-0 right-0 d-flex a-center j-end px-3\"\n      style=\"height: 100rpx;\"\n    >\n      <template v-if=\"status === '待支付'\">\n        <common-button @click=\"openPayMethods\">去支付</common-button>\n        <common-button @click=\"closeOrder\">取消订单</common-button>\n      </template>\n      <template v-else-if=\"status === '待发货'\">\n        <common-button>提醒发货</common-button>\n        <common-button @click=\"applyRefund\">申请退款</common-button>\n      </template>\n      <template v-else-if=\"status === '待收货'\">\n        <common-button @click=\"openLogistics\">查看物流</common-button>\n        <common-button @click=\"received\">确认收货</common-button>\n      </template>\n    </view>\n  </view>\n</template>\n\n<script>\nvar timer = null;\nimport orderListItem from '@/components/order/order-list-item.vue';\nimport uniListItem from '@/components/uni-ui/uni-list-item/uni-list-item.vue';\nimport price from '@/components/common/price.vue';\nimport card from '@/components/common/card.vue';\nimport $T from '@/common/lib/time.js';\nimport commonButton from '@/components/common/common-button.vue';\nexport default {\n  components: {\n    orderListItem,\n    uniListItem,\n    price,\n    card,\n    commonButton\n  },\n  data() {\n    return {\n      id: 0,\n      no: '',\n      address: {\n        province: '',\n        city: '',\n        district: '',\n        address: '',\n        zip: 0,\n        name: '',\n        phone: ''\n      },\n      total_price: 0,\n      remark: '',\n      paid_time: null,\n      payment_method: '',\n      payment_no: '',\n      refund_status: 'pending',\n      ship_status: '',\n      extra: null,\n      create_time: '',\n      update_time: '',\n      reviewed: 0,\n      order_items: [],\n      couponUserItem: [],\n      end_time: 0,\n      timeDown: ''\n    };\n  },\n  computed: {\n    // 商品总价\n    price() {\n      let p = 0;\n      this.order_items.forEach(item => {\n        p += item.pprice * item.num;\n      });\n      return p.toFixed(2);\n    },\n    path() {\n      let { province, city, district, address } = this.address;\n      return `${province} ${city} ${district} ${address}`;\n    },\n    // 订单状态\n    status() {\n      return this.$U.formatStatus({\n        paid_time: this.paid_time,\n        refund_status: this.refund_status,\n        ship_status: this.ship_status\n      });\n    },\n    coupon() {\n      if (Array.isArray(this.couponUserItem) && this.couponUserItem.length === 0) {\n        return '未使用';\n      }\n      let { type, value } = this.couponUserItem.coupon;\n      if (type === 0) {\n        return '-￥' + value;\n      } else {\n        return '打' + value + '折';\n      }\n    },\n    timeDownText() {\n      let msg = '';\n      switch (this.status) {\n        case '待支付':\n          msg = '取消';\n          break;\n        case '待收货':\n          msg = '确认';\n          break;\n        case '待发货':\n          return '等待商家发货';\n          break;\n        case '退款中':\n          return '等待商家审核';\n          break;\n        case '已签收':\n          return '订单已签收';\n          break;\n      }\n      if (msg !== '' && this.timeDown !== '') {\n        return `还差 ${this.timeDown} 自动${msg}`;\n      }\n      return '';\n    }\n  },\n  onLoad(e) {\n    if (!e.id) {\n      uni.showToast({\n        title: '订单不存在',\n        icon: 'none'\n      });\n      return uni.navigateBack({\n        delta: 1\n      });\n    }\n    this.id = e.id;\n  },\n  onUnload() {\n    if (timer) {\n      clearInterval(timer);\n    }\n  },\n  onShow() {\n    // 获取订单详情\n    this.getData();\n  },\n  methods: {\n    // 开启定时器\n    openTimeDown() {\n      if (this.status === '待支付' || this.status === '待收货') {\n        if (timer) {\n          clearInterval(timer);\n        }\n        timer = setInterval(() => {\n          let now = new Date().getTime() / 1000;\n          if (now > this.end_time) {\n            uni.switchTab({\n              url: '../index/index'\n            });\n            uni.showToast({\n              title: this.status === '待支付' ? '订单已关闭' : '订单已确认',\n              icon: 'none'\n            });\n            this.timeDown = '';\n            return clearInterval(timer);\n          }\n          this.timeDown = $T.timeDown(this.end_time);\n        }, 1000);\n      }\n    },\n    getData() {\n      this.$H\n        .get(\n          '/order/' + this.id,\n          {},\n          {\n            token: true\n          }\n        )\n        .then(res => {\n          console.log(res);\n          this.end_time = res.end_time ? res.end_time : 0;\n          this.no = res.no;\n          this.address = res.address;\n          this.total_price = res.total_price;\n          this.remark = res.remark;\n          this.paid_time = res.paid_time;\n          this.payment_method = res.payment_method;\n          this.payment_no = res.payment_no;\n          this.refund_status = res.refund_status;\n          this.ship_status = res.ship_status;\n          this.extra = res.extra;\n          this.create_time = res.create_time;\n          this.update_time = res.update_time;\n          this.reviewed = res.reviewed;\n          // 整理商品列表数据\n          let order_items = res.orderItems.map(v => {\n            let attrs = [];\n            if (v.skus_type === 1 && v.goodsSkus && v.goodsSkus.skus) {\n              let skus = v.goodsSkus.skus;\n              for (let k in skus) {\n                attrs.push(skus[k].value);\n              }\n            }\n            return {\n              id: v.goods_id,\n              cover: v.goodsItem.cover,\n              title: v.goodsItem.title,\n              pprice: v.price,\n              attrs: attrs.join(','),\n              num: v.num\n            };\n          });\n          // 开启定时器\n          this.openTimeDown();\n          this.order_items = order_items;\n          this.couponUserItem = res.couponUserItem;\n        });\n    },\n    // 去支付\n    openPayMethods() {\n      // 跳转到支付页面\n      uni.navigateTo({\n        url:\n          '/pages/pay-methods/pay-methods?detail=' +\n          JSON.stringify({\n            id: this.id,\n            price: this.total_price\n          })\n      });\n    },\n    // 取消订单\n    closeOrder() {\n      uni.showModal({\n        content: '是否要取消该订单？',\n        success: res => {\n          if (res.confirm) {\n            uni.showLoading({\n              title: '取消订单中...',\n              mask: false\n            });\n            this.$H\n              .post(\n                '/closeorder/' + this.id,\n                {},\n                {\n                  token: true\n                }\n              )\n              .then(res => {\n                uni.hideLoading();\n                uni.navigateBack({\n                  delta: 1\n                });\n                uni.showToast({\n                  title: '取消订单成功',\n                  icon: 'none'\n                });\n              })\n              .catch(err => {\n                uni.hideLoading();\n              });\n          }\n        }\n      });\n    },\n    // 申请退款\n    applyRefund() {\n      uni.navigateTo({\n        url:\n          '/pages/order-refund/order-refund?detail=' +\n          JSON.stringify({\n            id: this.id\n          })\n      });\n    },\n    // 查看物流\n    openLogistics() {\n      uni.navigateTo({\n        url:\n          '/pages/logistics-detail/logistics-detail?detail=' +\n          JSON.stringify({\n            id: this.id\n          })\n      });\n    },\n    // 确认收货\n    received() {\n      uni.showModal({\n        content: '是否要确认收货？',\n        success: res => {\n          if (res.confirm) {\n            uni.showLoading({\n              title: '确认收货中...',\n              mask: false\n            });\n            this.$H\n              .post(\n                '/order/' + this.id + '/received',\n                {},\n                {\n                  token: true\n                }\n              )\n              .then(res => {\n                uni.hideLoading();\n                uni.navigateBack({\n                  delta: 1\n                });\n                uni.showToast({\n                  title: '确认收货成功',\n                  icon: 'none'\n                });\n              })\n              .catch(err => {\n                uni.hideLoading();\n              });\n          }\n        }\n      });\n    }\n  }\n};\n</script>\n\n<style></style>\n"],"sourceRoot":""}