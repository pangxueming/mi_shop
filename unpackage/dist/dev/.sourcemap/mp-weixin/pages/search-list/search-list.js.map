{"version":3,"sources":["uni-app:///main.js","webpack:///D:/Code/Vue/新项目/mi_shop/pages/search-list/search-list.vue?8ed5","webpack:///D:/Code/Vue/新项目/mi_shop/pages/search-list/search-list.vue?3797","webpack:///D:/Code/Vue/新项目/mi_shop/pages/search-list/search-list.vue?d31a","webpack:///D:/Code/Vue/新项目/mi_shop/pages/search-list/search-list.vue?fa8f","uni-app:///pages/search-list/search-list.vue"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,6G;AACAA,UAAU,CAACC,mBAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAwH;AACxH;AAC+D;AACL;;;AAG1D;AACkN;AAClN,gBAAgB,sNAAU;AAC1B,EAAE,iFAAM;AACR,EAAE,sFAAM;AACR,EAAE,+FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,0FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA,WAAW,0MAEN;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAm1B,CAAgB,k0BAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACoDv2B;AACA;AACA,wBADA;AAEA,cAFA;AAGA,gCAHA;AAIA,0BAJA,EADA;;AAOA,MAPA,kBAOA;AACA;AACA;AACA,wBAFA;AAGA,iBAHA;AAIA,aAJA;AAKA,cALA;AAMA,sBANA;AAOA;AACA,uBADA;AAEA,gJAFA,EAPA;;AAWA;AACA,mBADA;AAEA;AACA,iDADA;AAEA,4DAFA;AAGA,kEAHA;AAIA,kEAJA;AAKA,kEALA;AAMA,kEANA,CAFA,EAXA;;;AAsBA,mBAtBA;AAuBA,oBAvBA;AAwBA,qBAxBA;;AA0BA,GAlCA;AAmCA;AACA;AACA,WAFA,qBAEA;AACA;AACA;AACA;AACA,aADA,EACA,KADA;;AAGA,KARA,EAnCA;;AA6CA,QA7CA,kBA6CA,CA7CA,EA6CA;AACA;AACA;AACA;AACA,GAjDA;AAkDA,eAlDA,2BAkDA;AACA;AACA;AACA;AACA;AACA,GAvDA;AAwDA,mCAxDA,6CAwDA,CAxDA,EAwDA;AACA;AACA,GA1DA;AA2DA,qCA3DA,iDA2DA;AACA;AACA,GA7DA;AA8DA,0BA9DA,sCA8DA;AACA;AACA,GAhEA;AAiEA;AACA,gBADA,0BACA;AACA;AACA;AACA;AACA,KALA;AAMA,UANA,oBAMA;AACA;AACA;AACA,0BADA;AAEA,sBAFA;;AAIA;AACA;AACA;AACA;AACA;AACA,KAjBA;AAkBA;AACA,cAnBA,wBAmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA,KA/BA;AAgCA;AACA,WAjCA,qBAiCA;AACA;AACA;AACA,UADA,CACA,eADA;AAEA,aAFA;AAGA,2BAHA;AAIA,kBAJA;AAKA,kBALA;AAMA,oBANA;;AAQA,UARA,CAQA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAjBA;AAkBA,KArDA;AAsDA;AACA,UAvDA,kBAuDA,GAvDA,EAuDA;AACA;AACA;AACA;AACA,kBADA;AAEA,wBAFA;AAGA,2BAHA;AAIA,sBAJA;AAKA,6BALA;AAMA,uCANA;AAOA,6CAPA;;AASA,OAXA;AAYA,KApEA;AAqEA,gBArEA,wBAqEA,KArEA,EAqEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAvFA;AAwFA;AACA,cAzFA,wBAyFA;AACA;AACA;AACA;AACA,KA7FA,EA6FA;AACA,eA9FA,yBA8FA;AACA;AACA;AACA;AACA;AACA;AACA,KApGA;AAqGA;AACA,WAtGA,qBAsGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA7GA;AA8GA;AACA,SA/GA,mBA+GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAtHA;AAuHA;AACA,gBAxHA,0BAwHA;AACA;AACA;AACA,KA3HA,EAjEA,E","file":"pages/search-list/search-list.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/search-list/search-list.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./search-list.vue?vue&type=template&id=1116b14e&\"\nvar renderjs\nimport script from \"./search-list.vue?vue&type=script&lang=js&\"\nexport * from \"./search-list.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/search-list/search-list.vue\"\nexport default component.exports","export * from \"-!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./search-list.vue?vue&type=template&id=1116b14e&\"","var components = {\n  searchList: function() {\n    return import(\n      /* webpackChunkName: \"components/search-list/search-list\" */ \"@/components/search-list/search-list.vue\"\n    )\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./search-list.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX.2.7.14.20200618.full/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./search-list.vue?vue&type=script&lang=js&\"","<template>\r\n  <view>\r\n    <!-- 自定义导航 -->\r\n    <!-- #ifdef MP -->\r\n    <view class=\"d-flex a-center position-fixed bg-white\" style=\"height: 90rpx; top:0;right: 0;left: 0; z-index: 1000;\">\r\n      <!-- 中间 -->\r\n      <input type=\"text\" v-model=\"keyword\" class=\"flex-1 bg-light rounded ml-3 px-2\" style=\"height: 65rpx;\" placeholder=\"智能积木\" />\r\n      <!-- 右边 -->\r\n      <view style=\"width: 85rpx;\" class=\"d-flex a-center j-center\" @click=\"search\">搜索</view>\r\n      <view style=\"height: 90rpx;\"></view>\r\n    </view>\r\n    <!-- #endif -->\r\n    <!-- 排序/筛选 -->\r\n    <view class=\"\" style=\"height: 100rpx;\"></view>\r\n    <view class=\"position-fixed d-flex row border-top border-bottom  a-center\" style=\"height: 100rpx;right: 0;left: 0;background-color: #FFFFFF;z-index: 1000;\">\r\n      <view class=\"d-flex flex-1 j-center a-center font-md\" v-for=\"(item, index) in screen.list\" :key=\"index\" @tap=\"changeScreen(index)\">\r\n        <text :class=\"screen.currentIndex === index ? 'main-text-color' : 'text-muted'\">{{ item.name }}</text>\r\n        <view class=\"\">\r\n          <view class=\"iconfont icon-paixu-shengxu line-h0\" :class=\"item.status === 1 ? 'main-text-color' : 'text-light-muted'\"></view>\r\n          <view class=\"iconfont icon-paixu-jiangxu line-h0\" :class=\"item.status === 2 ? 'main-text-color' : 'text-light-muted'\"></view>\r\n        </view>\r\n      </view>\r\n      <view class=\"d-flex flex-1  a-center j-center main-text-color\" @tap=\"showDrawer\">筛选</view>\r\n    </view>\r\n    <!-- 右侧滑出抽屉 -->\r\n    <uni-drawer ref=\"drawer\" mode=\"right\" :width=\"300\" @close=\"closeDrawer\">\r\n      <view style=\"height: 100rpx;\"></view>\r\n      <card :headBorderBottom=\"false\" :headerTitleWeight=\"false\">\r\n        <text slot=\"title\">价格范围</text>\r\n        <!-- 单选按钮组 -->\r\n        <zcm-radio-group :label=\"label\" :selected.sync=\"label.selected\"></zcm-radio-group>\r\n      </card>\r\n      <!-- 按钮 -->\r\n      <view class=\"d-flex position-fixed bottom-0 right-0 w-100 border-top border-light-secondary\">\r\n        <view class=\"flex-1 main-bg-color text-white font-md py-2 text-center\" hover-class=\"main-bg-hover-color\" @click=\"comfire\">确定</view>\r\n        <view class=\"flex-1 font-md py-2 text-center\" hover-class=\"bg-light-secondary\" @click=\"reset\">重置</view>\r\n      </view>\r\n    </uni-drawer>\r\n    <!-- 列表 -->\r\n    <block v-for=\"(item, index) in list\" :key=\"index\"><search-list :item=\"item\" :index=\"index\"></search-list></block>\r\n    <!-- 上拉加载更多 -->\r\n    <divider />\r\n    <view class=\"d-flex a-center j-center text-light-muted font-md py-3\">{{ loadtext }}</view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport uniDrawer from '@/components/uni-ui/uni-drawer/uni-drawer.vue';\r\nimport card from '@/components/common/card.vue';\r\nimport zcmRadioGroup from '@/components/common/radio-group.vue';\r\nimport searchList from '@/components/search-list/search-list.vue';\r\n\r\nexport default {\r\n  components: {\r\n    uniDrawer,\r\n    card,\r\n    zcmRadioGroup,\r\n    searchList\r\n  },\r\n  data() {\r\n    return {\r\n      // 1.上拉加载更多 2.加载中... 3.没有更多了\r\n      loadtext: '上拉加载更多',\r\n      keyword: '',\r\n      page: 1,\r\n      list: [],\r\n      showRight: false,\r\n      screen: {\r\n        currentIndex: 0,\r\n        list: [{ name: '综合', status: 1, key: 'all' }, { name: '销量', status: 0, key: 'sale_count' }, { name: '价格', status: 0, key: 'min_price' }]\r\n      },\r\n      label: {\r\n        selected: 0,\r\n        list: [\r\n          { name: '不限', rule: false, value: false },\r\n          { name: '0-0.02', rule: 'between', value: '0,0.02' },\r\n          { name: '0.02-0.04', rule: 'between', value: '0.02,0.04' },\r\n          { name: '0.04-0.06', rule: 'between', value: '0.04,0.06' },\r\n          { name: '0.06-0.08', rule: 'between', value: '0.06,0.08' },\r\n          { name: '0.08-0.10', rule: 'between', value: '0.08,0.10' }\r\n        ]\r\n      },\r\n      condition: {},\r\n      oldSelected: 0,\r\n      searchInput: ''\r\n    };\r\n  },\r\n  computed: {\r\n    // 排序相关\r\n    options() {\r\n      let obj = this.screen.list[this.screen.currentIndex];\r\n      let value = obj.status === 1 ? 'asc' : 'desc';\r\n      return {\r\n        [obj.key]: value\r\n      };\r\n    }\r\n  },\r\n  onLoad(e) {\r\n    this.keyword = e.keyword;\r\n    this.getData();\r\n    // uni.searchInput.placeHolder = this.searchInput;\r\n  },\r\n  onReachBottom() {\r\n    if (this.loadtext !== '上拉加载更多') return;\r\n    this.loadtext = '加载中...';\r\n    this.page++;\r\n    this.getData(false);\r\n  },\r\n  onNavigationBarSearchInputChanged(e) {\r\n    this.keyword = e.text;\r\n  },\r\n  onNavigationBarSearchInputConfirmed() {\r\n    this.search();\r\n  },\r\n  onNavigationBarButtonTap() {\r\n    this.search();\r\n  },\r\n  methods: {\r\n    __initSearch() {\r\n      this.label.selected = 0;\r\n      this.condition = {};\r\n      this.page++;\r\n    },\r\n    search() {\r\n      if (this.keyword === '') {\r\n        return uni.showToast({\r\n          title: '关键字不能为空',\r\n          icon: 'none'\r\n        });\r\n      }\r\n      uni.hideKeyboard();\r\n      this.addHistory();\r\n      this.__initSearch();\r\n      this.getData();\r\n    },\r\n    // 加入搜索记录\r\n    addHistory() {\r\n      // 拿到所有的搜索历史\r\n      let history = uni.getStorageSync('searchHistory');\r\n      this.searchInput = history = history ? JSON.parse(history) : [];\r\n      // 判断之前是否有该搜索记录\r\n      let index = history.indexOf(this.keyword);\r\n      if (index === -1) {\r\n        history.unshift(this.keyword);\r\n      } else {\r\n        history.unshift(history.splice(index, 1)[0]);\r\n      }\r\n      uni.setStorageSync('searchHistory', JSON.stringify(history));\r\n    },\r\n    // 加载数据\r\n    getData(refresh = true, callback = false) {\r\n      let page = refresh ? 1 : this.page;\r\n      this.$H\r\n        .post('/goods/search', {\r\n          id: 0,\r\n          title: this.keyword,\r\n          page: page,\r\n          ...this.options,\r\n          ...this.condition\r\n        })\r\n        .then(res => {\r\n          // console.log(JSON.stringify(res));\r\n          let list = this.format(res);\r\n          this.list = refresh ? [...list] : [...this.list, ...list];\r\n\r\n          this.loadtext = res.length < 10 ? '没有更多了' : '上拉加载更多';\r\n          if (typeof callback === 'function') {\r\n            callback();\r\n          }\r\n        });\r\n    },\r\n    // 格式化\r\n    format(res) {\r\n      return res.map(v => {\r\n        var good_num = v.comments_count === 0 ? 0 : (v.comments_good_count / v.comments_count) * 100;\r\n        return {\r\n          id: v.id,\r\n          title: v.title,\r\n          titleImg: v.cover,\r\n          desc: v.desc,\r\n          pprice: v.min_price,\r\n          comment_num: v.comments_count,\r\n          good_num: good_num.toFixed(2) + '%'\r\n        };\r\n      });\r\n    },\r\n    changeScreen(index) {\r\n      //判断当前点击是否是激活状态\r\n      let oldIndex = this.screen.currentIndex;\r\n      let oldItem = this.screen.list[oldIndex];\r\n      if (oldIndex === index) {\r\n        oldItem.status = oldItem.status === 1 ? 2 : 1;\r\n        // 加载数据\r\n        this.getData();\r\n        return;\r\n      }\r\n      let newItem = this.screen.list[index];\r\n      //移除激活状态\r\n      oldItem.status = 0;\r\n      this.screen.currentIndex = index;\r\n      //增加新激活状态\r\n      newItem.status = 1;\r\n      // 加载数据\r\n      this.getData();\r\n    },\r\n    // 显示右边抽屉\r\n    showDrawer() {\r\n      this.$refs.drawer.open();\r\n      // 记录旧的值\r\n      this.oldSelected = this.label.selected;\r\n    }, //关闭抽屉\r\n    closeDrawer() {\r\n      // 恢复回原来的值\r\n      this.label.selected = this.oldSelected;\r\n      //关闭抽屉\r\n      this.$refs.drawer.close();\r\n      this.oldSelected = 0;\r\n    },\r\n    //提交筛选条件\r\n    comfire() {\r\n      // 组织筛选条件\r\n      this.getCondition();\r\n      // 获取数据\r\n      this.getData();\r\n      //关闭抽屉\r\n      this.$refs.drawer.close();\r\n    },\r\n    // 重置\r\n    reset() {\r\n      this.condition = {};\r\n      this.label.selected = 0;\r\n      // 获取数据\r\n      this.getData();\r\n      //关闭抽屉\r\n      this.$refs.drawer.close();\r\n    },\r\n    // 组织价格筛选条件\r\n    getCondition() {\r\n      let item = this.label.list[this.label.selected];\r\n      this.condition = item.rule && item.value ? { price: item.rule + ',' + item.value } : {};\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style></style>\n"],"sourceRoot":""}